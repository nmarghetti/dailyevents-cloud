Parse.initialize("uI57rIax4Tk31J5dI9EUKR3dCDhaeNphH2D0MmG1","E9GTKYZBjxPHuI0YIajAeKAtSeWZ4wzXJfysRq4g");var data={};function registerClient(){data.clientId=$.cookie("clientId");data.clientId||Parse.Cloud.run("register",{environment:navigator.userAgent},{success:function(a){data.clientId=a.id;$.cookie("clientId",data.clientId,{expires:3650})},error:function(){}})} function refreshGroup(){data.groupCode&&Parse.Cloud.run("getGroupByCode",{code:data.groupCode},{success:function(a){a.id?(data.groupId=a.id,data.groupName=a.name,document.title=data.groupName,$("#title").text(data.groupName),refreshEvent()):(data.groupCode=null,enableOrDisableButtons())},error:function(){}})} function refreshEvent(){if(data.groupId){var a=new Date;Parse.Cloud.run("getEvent",{groupId:data.groupId,timestamp:a.getTime(),timezone:a.getTimezoneOffset()},{success:function(a){var b=a.statuses;$("#participants").empty();for(var d in b)"yes"==b[d].reply&&$("#participants").append("<li>"+b[d].participant+"</li>");a=a.comments;$("#comments").empty();for(d in a)b=new Date(parseInt(a[d].timestamp)),b=toTwoDigits(b.getHours())+":"+toTwoDigits(b.getMinutes())+" "+a[d].participant,$("#comments").append("<li>"+ b+": "+a[d].comment+"</li>")},error:function(){}})}}function confirmAttendance(){setStatus("yes")}function cancelAttendance(){setStatus("no")}function setStatus(a){data.groupId&&Parse.Cloud.run("setStatus",{clientId:data.clientId,groupId:data.groupId,participant:getDisplayName(),reply:a,timestamp:getTimestamp(),timezone:getTimezone()},{success:function(){refreshEvent()},error:function(){}})} function addComment(){var a=$("#comment").val();data.groupId&&a&&Parse.Cloud.run("addComment",{clientId:data.clientId,groupId:data.groupId,participant:getDisplayName(),comment:a,timestamp:getTimestamp(),timezone:getTimezone()},{success:function(){$("#comment").val("");refreshEvent()},error:function(){}})}function readQueryParameters(){data.groupCode=$.url().param("code");$("#display_name").val($.url().param("name"))} function enableOrDisableButtons(){var a=[$("#refresh"),$("#reply_yes"),$("#reply_no"),$("#add_comment")],c;for(c in a)data.groupCode?a[c].removeClass("ui-disabled"):a[c].addClass("ui-disabled")}function activateFieldValidation(){var a=function(){var a=$(this).val(),b=$(this).attr("maxlength");a.length>b&&$(this).val(a.substr(0,b))},c=[$("#display_name"),$("#comment")],b;for(b in c)c[b].keydown(a),c[b].keyup(a)} function bindActions(){$("#refresh").bind("click",refreshEvent);$("#reply_yes").bind("click",confirmAttendance);$("#reply_no").bind("click",cancelAttendance);$("#add_comment").bind("click",addComment);$("#comment").keypress(function(a){13==a.keyCode&&(addComment(),a.preventDefault())})}function getDisplayName(){return $("#display_name").val()}function getTimestamp(){return(new Date).getTime().toString()}function getTimezone(){return(new Date).getTimezoneOffset().toString()} function toTwoDigits(a){return 10>a?"0"+a:a}$(document).ready(function(){registerClient();readQueryParameters();activateFieldValidation();enableOrDisableButtons();refreshGroup();bindActions()});